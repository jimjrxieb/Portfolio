# Production configuration for linksmlm.com deployment
# Used for live production deployment with Cloudflare tunnel

# Image Configuration
image:
  repository: ghcr.io/jimjrxieb/portfolio-api
  tag: "v1.0.0"
  pullPolicy: Always

ui:
  image:
    repository: ghcr.io/jimjrxieb/portfolio-ui
    tag: "vite-fix-v4"
    pullPolicy: Always

# GHCR is private — need pull secret
imagePullSecrets:
  - name: ghcr-pull

# Ingress Configuration for linksmlm.com
ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/cors-allow-origin: "https://linksmlm.com"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "Content-Type, Authorization"
    nginx.ingress.kubernetes.io/enable-cors: "true"
  host: linksmlm.com
  tls: false  # Cloudflare handles TLS

# Resource configuration - optimized for local KinD
resources:
  api:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "1Gi"
  ui:
    requests:
      cpu: "50m"
      memory: "128Mi"
    limits:
      cpu: "200m"
      memory: "512Mi"

# ChromaDB Configuration - ENABLED for production
chroma:
  enabled: true
  image:
    repository: chromadb/chroma
    tag: "0.4.18"
    pullPolicy: IfNotPresent
  service:
    port: 8000
  persistence:
    enabled: false  # Use emptyDir — rag-sync repopulates on startup

# Persistence Configuration
# Disabled: PSS restricted blocks the root fix-perms init container
# Using emptyDir instead (matches method1 deployment)
persistence:
  enabled: false

# Environment Variables - Production
env:
  api:
    DEBUG_MODE: "false"
    LOG_LEVEL: "INFO"
    LLM_PROVIDER: "claude"
    LLM_MODEL: "claude-3-haiku-20240307"
    OLLAMA_URL: "http://localhost:11434"
    EMBED_MODEL: "nomic-embed-text"
    API_PORT: "8000"
    API_HOST: "0.0.0.0"
    CORS_ALLOW_ORIGINS: "https://linksmlm.com,http://localhost:8080"
    RAG_NAMESPACE: "portfolio"
    # CHROMA_URL and DATA_DIR are set by template conditionals (chroma.enabled, persistence.enabled)
    TTS_ENGINE: "disabled"
    AVATAR_ENGINE: "disabled"
  ui:
    VITE_API_BASE_URL: "https://linksmlm.com/api"

# Security - slightly relaxed for local development
securityContext:
  runAsNonRoot: true
  runAsUser: 10001
  runAsGroup: 10001
  fsGroup: 10001

# Network Policy - disabled for easier local testing
networkPolicy:
  enabled: false
