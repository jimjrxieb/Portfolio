# Apply with: kubectl -n portfolio patch deploy portfolio-api --patch-file k8s/patch-poststart.yaml
spec:
  template:
    spec:
      securityContext:
        runAsNonRoot: true
        runAsUser: 1000
        runAsGroup: 1000
      containers:
      - name: api
        lifecycle:
          postStart:
            exec:
              command: ["/bin/sh", "-lc", "python ingest.py || true"]
        env:
        - name: SENTENCE_TRANSFORMERS_HOME
          value: "/data/cache"
        - name: TRANSFORMERS_CACHE  
          value: "/data/cache"
        - name: HF_HOME
          value: "/data/cache"