apiVersion: batch/v1
kind: Job
metadata:
  name: portfolio-ingest
  namespace: portfolio
spec:
  template:
    spec:
      restartPolicy: Never
      containers:
      - name: ingest
        image: ghcr.io/shadow-link-industries/portfolio-api:with-data
        command: ["python", "ingest.py"]
        workingDir: /app
        env:
          - { name: CHROMA_DIR, value: "/data/chroma" }
          - { name: SENTENCE_TRANSFORMERS_HOME, value: "/data/cache" }
          - { name: TRANSFORMERS_CACHE, value: "/data/cache" }
        volumeMounts:
          - { name: data, mountPath: /data }
      volumes:
        - name: data
          persistentVolumeClaim: { claimName: chroma-pvc }